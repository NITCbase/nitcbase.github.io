<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Roadmap/Stage10">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Stage 10: B+ Tree Search on Relations | NITCbase</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nitcbase.github.io/docs/Roadmap/Stage10"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Stage 10: B+ Tree Search on Relations | NITCbase"><meta data-rh="true" name="description" content="- Understand the fundamentals of the B+ tree data structure and how it can be used for the purposes of indexing."><meta data-rh="true" property="og:description" content="- Understand the fundamentals of the B+ tree data structure and how it can be used for the purposes of indexing."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://nitcbase.github.io/docs/Roadmap/Stage10"><link data-rh="true" rel="alternate" href="https://nitcbase.github.io/docs/Roadmap/Stage10" hreflang="en"><link data-rh="true" rel="alternate" href="https://nitcbase.github.io/docs/Roadmap/Stage10" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/feedback/rss.xml" title="NITCbase RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/feedback/atom.xml" title="NITCbase Atom Feed">





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.a8697131.css">
<link rel="preload" href="/assets/js/runtime~main.72ea9b40.js" as="script">
<link rel="preload" href="/assets/js/main.cbbded3f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="NITCbase" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="NITCbase" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">NITCbase</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Roadmap/">Roadmap</a><a class="navbar__item navbar__link" href="/docs/Design/Architecture">Design</a><a class="navbar__item navbar__link" href="/docs/User Interface Commands/">Commands</a><a class="navbar__item navbar__link" href="/docs/Misc/">Miscellaneous</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/feedback">Feedback</a><a class="navbar__item navbar__link" href="/AboutUs">About Us</a><a href="https://groups.google.com/g/nitcbase-users" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/nitcbase" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="The GitHub repository of the project"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.svg" alt="NITCbase" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="NITCbase" class="themedImage_ToTc themedImage--dark_i4oU"><b>NITCbase</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage00">Stage 0 : Installation and Preparation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage01">Stage 1 : Understanding the Disk Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage02">Stage 2: Record Blocks and Catalogs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage03">Stage 3 : The Disk Buffer and Catalog Caches</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage04">Stage 4 : Linear Search on Relations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage05">Stage 5 : Opening Relations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage06">Stage 6 : Buffer Management and Disk Write-back</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage07">Stage 7 : Inserting Records Into Relations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage08">Stage 8 : Creating and Deleting Relations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage09">Stage 9 : Selection and Projection on Relations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/Roadmap/Stage10">Stage 10: B+ Tree Search on Relations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage11">Stage 11: Index Creation and Deletion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage12">Stage 12: Join on Relations</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Stage 10: B+ Tree Search on Relations (18 hours)</h1><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Learning Objectives</div><div class="admonitionContent_S0QG"><ul><li>Understand the fundamentals of the B+ tree data structure and how it can be used for the purposes of indexing.</li><li>Understand how indexes are stored in the XFS disk</li><li>Implement the B+ tree search operations to select records in NITCbase</li></ul></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>PREREQUISITE READING</div><div class="admonitionContent_S0QG"><ul><li><a href="/docs/Misc/B+ Trees">B+ Trees</a></li></ul></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">â€‹</a></h2><p>A relation in a production database can contain millions or records and might span over a large number of disk blocks. An index would help us to traverse these disk blocks much quicker than a linear search over every record. If we find ourselves frequently doing search operations on the values of one specific attribute of the relation, then creating an index on that attribute will immensely speed up the search.</p><p>For example, consider the relation <code>Student</code> having 5 attributes (<code>Roll No</code>, <code>Name</code>, <code>Marks</code>, <code>Grade</code>, <code>Attendance</code>). As an administrator, we might have to frequently get the subset of students having <code>Marks</code> greater than some amount <code>M</code>. Instead of going through each and every record and checking if it satisfies our condition, the index allows us to easily reach the first record with <code>Marks</code> &gt; <code>M</code>. We know that in a B+ tree, every subsequent leaf node will also satisfy this condition (Why?). You can see how this would save us a lot of time.</p><p>In NITCbase, indexes are B+ trees with <strong>internal nodes of size 100</strong>, and <strong>leaf nodes of size 63</strong>. Each of these nodes will be stored in a separate disk block. A fully filled internal node would consist of a 100 attribute values from various records and 101 pointers to their respective children. A pointer here refers to the block number of the corresponding internal or leaf index block. A fully filled leaf node would consist of 63 attribute values from various records. For each of these attribute values, the block number and slot number of the record with this value is also stored.</p><p>The <a href="/docs/Design/Physical Layer#attribute-catalog">attribute catalog</a> stores whether a particular attribute of a relation has an index. If it does, the <code>RootBlock</code> field of the attribute catalog will store the block number of the root block of the index. If not, <code>RootBlock</code> will contain the value <code>-1</code>.</p><p>To proceed further, we will need some prerequisite reading.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>PREREQUISITE READING</div><div class="admonitionContent_S0QG"><ul><li><a href="/docs/Design/Physical Layer#internal-index-block-structure">Internal Index Blocks</a></li><li><a href="/docs/Design/Physical Layer#leaf-index-block-structure">Leaf Index Blocks</a></li></ul></div></div><p>A production database might automatically create and dispose of indexes as required by the program without user intervention. In NITCbase, the user is expected to decide when the index is to be created and dropped (using the <a href="/docs/User Interface Commands/ddl#create-index">CREATE INDEX</a> and <a href="/docs/User Interface Commands/ddl#drop-index">DROP INDEX</a> commands of the <a href="/docs/Design/Schema Layer">Schema Layer</a>). Note that we will not be implementing these commands in the present stage and will instead be using them through the XFS Interface.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><p>Q. Assume that we have an empty database with no relations. We start it and create a table <code>LibraryBooks(name STR, id NUM, shelf NUM, borrower STR)</code>. We then insert 1000 records into the relation <code>LibraryBooks</code> in descending order of their <code>id</code>. It is given that the records have <code>id</code> from 1000 to 1.</p><ol><li>If we were to do a search for a book with <code>id</code> &gt; 500, which book would we get? What&#x27;s the corresponding <em>record-id=(block, slot)</em>?</li><li>We then create an index on <code>id</code> for <code>LibraryBooks</code>. How many index blocks would be created?</li><li>How many entries does the root block have? What is the rightmost value in the root node of the B+ tree?</li><li>If we were to again do a search for a book with <code>id</code> &gt; 500, which book would we get? What is the index of the entry corresponding to the found record in the leaf node of the B+ tree?</li></ol><p>(click to view answer)</p></summary><div><div class="collapsibleContent_i85q"><p><strong>Answer</strong></p><ol><li>We will get the record with <code>id</code>=1000 because that&#x27;s the first record that will satisfy the condition when a linear search is done. Since this record will be the first record in the first block of the relation, we get that the rec-id is <code>{6, 1}</code>. The 7th block is the first block that is available to be used by a relation as the first 6 blocks are reserved.</li><li>There will be 31 leaf index blocks and 1 internal index block.</li><li>The root block will have 30 entries. The rightmost value in the node will be 968.</li><li>We would get the book with <code>id</code> 501 because the records will be sorted in ascending order in the leaf node. B+ search will return the first node in the leaf that satisfies the condition.</li></ol></div></div></details><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="implementation">Implementation<a href="#implementation" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">â€‹</a></h2><p>In this stage, you will implement the B+ search operations on a relation in the <code>BPlusTree::bPlusSearch()</code> function. We will also modify the functions we designed earlier to do an indexed search if an index is available.</p><p>Similar to the linear search operation that you implemented in the <a href="/docs/Design/Block Access Layer">Block Access Layer</a>, the <code>BPlusTree::bPlusSearch()</code> function, when called for the first time, will return the first record that satisfies the given condition. Every subsequent call to the function will return a proceeding record that satisfies the condition until there are no more records to be returned.</p><p>Recall that in <code>BlockAccess::linearSearch()</code>, the position of the previously returned record was stored in the <a href="/docs/Design/Cache Layer/RelCacheTable">RelCacheTable</a> in the <code>searchIndex</code> field of the entry corresponding to the relation. This field was used to keep track of the position while searching through the records. To restart a search from the beginning, we would have to <strong>reset the search index</strong> using the <code>RelCacheTable::resetSearchIndex()</code> function.</p><p>The <code>BPlusTree::bPlusSearch()</code> function too makes use of a <code>searchIndex</code> field to keep track of it&#x27;s previous search position in the leaf of the B+ tree. For a B+ search on the B+ tree of an attribute, the search index is stored in the linked list entry corresponding to the attribute in the <a href="/docs/Design/Cache Layer/AttrCacheTable">AttrCacheTable</a> entry of the relation. The search index can be reset using the <code>AttrCacheTable::resetSearchIndex()</code> function.</p><p>Unlike the search index in the relation cache, this search index does not store the rec-id of the record (from the linear search). Here, the search index stores the last entry in the leaf of the B+ tree that matched our search (that is, the block number and the entry within the leaf index block).</p><p>To proceed further, you will need to read the documentation explaining how indexing is implemented in NITCbase. While the earlier documentation explained the algorithms of the B+ tree data structure, the following document explains the specific implementation details of this data structure in NITCbase.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>PREREQUISITE READING</div><div class="admonitionContent_S0QG"><ul><li><a href="/docs/Misc/Indexing">Indexing in NITCbase</a></li></ul></div></div><p>To add the B+ tree search functionality, we will need to implement the following:</p><ul><li>The <a href="/docs/Design/Buffer Layer/intro">Buffer Layer</a> methods to read from index blocks.<ul><li>Here, we introduce three new classes <a href="/docs/Design/Buffer Layer/IndBuffer#class-indbuffer">IndBuffer</a>, <a href="/docs/Design/Buffer Layer/IndBuffer#class-indinternal">IndInternal</a> and <a href="/docs/Design/Buffer Layer/IndBuffer#class-indleaf">IndLeaf</a>.</li><li><code>IndBuffer</code> is an <a href="https://en.wikipedia.org/wiki/Abstract_type" target="_blank" rel="noopener noreferrer">abstract class</a> which defines <a href="https://en.wikipedia.org/wiki/Virtual_function" target="_blank" rel="noopener noreferrer">virtual methods</a> to access and update entries in index blocks. Note that <code>IndBuffer</code> cannot be instantiated owing to it being abstract.</li><li><code>IndInternal</code> and <code>IndLeaf</code> are children of <code>IndBuffer</code> used for buffered access to leaf blocks and internal index blocks respectively of the B+ tree.</li></ul></li><li>The <a href="/docs/Design/Cache Layer/intro">Cache Layer</a> methods to read and update the <strong>search index in the <a href="/docs/Design/Cache Layer/AttrCacheTable">attribute cache</a></strong></li><li>The <a href="/docs/Design/B+ Tree Layer">B+ Tree Layer</a> method to search through a B+ tree present in the disk</li><li>Modifications to the <a href="/docs/Design/Block Access Layer">Block Access Layer</a> to call the B+ search if an index is present</li><li>Modifications to the <a href="/docs/Design/Algebra Layer">Algebra Layer</a> to reset the search index in the attribute cache before beginning B+ search</li></ul><p>A sequence diagram documenting the call sequence for a call to the <code>BlockAccess::search()</code> function is shown below.</p><blockquote><p><strong>NOTE</strong>: The functions are denoted with circles as follows.<br>
ðŸ”µ -&gt; methods that are already in their final state<br>
ðŸŸ¢ -&gt; methods that will attain their final state in this stage<br>
ðŸŸ¤ -&gt; methods that we built earlier and require more work later, but will leave as is in this stage</p></blockquote><br><p>A class diagram showing all the relevant methods is given below. Note that the <a href="/docs/Design/Buffer Layer/intro">Buffer Layer</a> classes corresponding to record blocks have been omitted for the sake of brevity.</p><p><strong>Cache Layer</strong></p><p><strong>Buffer Layer</strong></p><br><p>When an index is created on an attribute of a relation, the attribute catalog entry of the attribute is updated to store the block number of the root block of the B+ tree. This may be a leaf index block or an internal index block. (It will be a leaf if the total number of records is less than 63. Otherwise, there will be multiple leaf blocks and consequently an internal index block.)</p><p>Recall that the <code>search()</code> function in the <a href="/docs/Design/Block Access Layer">Block Access Layer</a> is used to either do a B+ search or a linear search depending on the presence of an index. Our earlier implementation did not account for indexes and directly called the <code>BlockAccess:linearSearch()</code> function. We now modify that function to check the attribute catalog entry and call the <a href="/docs/Design/B+ Tree Layer#bplustreebplussearch"><code>BPlusTree::bPlusSearch()</code></a> function if there is an index (we will implement this function later in this stage).</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>BlockAccess/BlockAccess.cpp</summary><div><div class="collapsibleContent_i85q"><p>Implement the <code>BlockAccess::search()</code> function by looking at the <a href="/docs/Design/Block Access Layer#blockaccess--search">design docs</a>.</p></div></div></details><p>In the <a href="/docs/Design/Cache Layer/intro">Cache Layer</a>, we add the methods to work with the search index in the attribute cache similar to what we had implemented for the search index in the relation cache. We have methods <code>AttrCacheTable::getSearchIndex()</code>, <code>AttrCacheTable::setSearchIndex()</code> and <code>AttrCacheTable::resetSearchIndex()</code>. Note that each of these methods are overloaded to identify an attribute with either the attribute name or attribute offset. Thus, we have a total of 6 functions to implement in the <a href="/docs/Design/Cache Layer/AttrCacheTable">AttrCacheTable</a> class.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Cache/AttrCacheTable.cpp</summary><div><div class="collapsibleContent_i85q"><p>Implement the following functions looking at their respective design docs</p><ul><li><a href="/docs/Design/Cache Layer/AttrCacheTable#attrcachetable--getsearchindex"><code>AttrCacheTable::getSearchIndex(relId, attrName, searchIndex*)</code></a></li><li><a href="/docs/Design/Cache Layer/AttrCacheTable#attrcachetable--getsearchindex"><code>AttrCacheTable::getSearchIndex(relId, attrOffset, searchIndex*)</code></a></li><li><a href="/docs/Design/Cache Layer/AttrCacheTable#attrcachetable--setsearchindex"><code>AttrCacheTable::setSearchIndex(relId, attrName, searchIndex*)</code></a></li><li><a href="/docs/Design/Cache Layer/AttrCacheTable#attrcachetable--setsearchindex"><code>AttrCacheTable::setSearchIndex(relId, attrOffset, searchIndex*)</code></a></li><li><a href="/docs/Design/Cache Layer/AttrCacheTable#attrcachetable--resetsearchindex"><code>AttrCacheTable::resetSearchIndex(relId, attrName, searchIndex*)</code></a></li><li><a href="/docs/Design/Cache Layer/AttrCacheTable#attrcachetable--resetsearchindex"><code>AttrCacheTable::resetSearchIndex(relId, attrOffset, searchIndex*)</code></a></li></ul></div></div></details><p>We had earlier modified <code>BlockAccess::search()</code> such that it can do either a linear search or a B+ search. Recall that in our current implementation, we always reset the search index in the relation cache before the first call to <code>linearSearch()</code> or <code>search()</code> to start searching from the beginning. It is now needed to modify the design to reset the search index in the attribute cache before the first call to <code>bPlusSearch()</code> or <code>search()</code>.</p><p>Thus far in our implementation, <code>BlockAccess::search()</code> has only been used in the <code>select()</code> function in the <a href="/docs/Design/Algebra Layer">Algebra Layer</a>. So, we modify our earlier design to call <code>AttrCacheTable::resetSearchIndex()</code> before the first call to <code>search()</code>.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Algebra/Algebra.cpp</summary><div><div class="collapsibleContent_i85q"><p>Implement the <code>Algebra::select()</code> function by looking at the <a href="/docs/Design/Algebra Layer#select">design docs</a>.</p></div></div></details><p>In the <a href="/docs/Design/Buffer Layer/intro">Buffer Layer</a>, we implement the methods to read from index blocks using classes <code>IndInternal</code> and <code>IndLeaf</code> as mentioned earlier. Similar to how we&#x27;ve used <code>RecBuffer</code> to read from record blocks thus far, the <code>IndBuffer</code> class defines virtual methods <code>getEntry()</code> and <code>setEntry()</code> to access the entry at a particular index in a B+ tree node. Note that every node of the B+ tree occupies an entire block of the XFS disk.</p><p>The <code>IndInternal</code> and <code>IndLeaf</code> classes also define a <em>constructor 1</em> (which is used to read from an already allocated index block) and a <em>constructor 2</em> (which is used to allocate a new index block) similar to what we had implemented for <code>RecBuffer</code>. These constructors call their parent class <code>IndBuffer</code>&#x27;s <em>constructor 1</em> and <em>constructor 2</em> respectively which in turn calls the corresponding <code>BlockBuffer</code> constructors that we implemented earlier.</p><p>Similar to the <a href="/docs/Design/Buffer Layer/intro#attribute">struct Attribute</a> that we used to hold the values in a record, we have helper structs to store index entries as well. An entry from a leaf index block is represented using <a href="/docs/Design/Buffer Layer/intro#index">struct Index</a> and an entry from an internal index block is represented using <a href="/docs/Design/Buffer Layer/intro#internalentry">struct InternalEntry</a>.</p><p>Since we do not need to modify indexes at this stage, we will only be implementing the <code>getEntry()</code> method. We will also define an empty <code>setEntry()</code> method to avoid compilation issues.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Buffer/BlockBuffer.cpp</summary><div><div class="collapsibleContent_i85q"><p>Implement the following constructors looking at the respective design docs</p><ul><li><a href="/docs/Design/Buffer Layer/IndBuffer#indbuffer--indbuffer-constructor-1"><code>IndBuffer::Constructor1</code></a></li><li><a href="/docs/Design/Buffer Layer/IndBuffer#indbuffer--indbuffer-constructor-2"><code>IndBuffer::Constructor2</code></a></li><li><a href="/docs/Design/Buffer Layer/IndBuffer#indinternal--indinternal-constructor-1"><code>IndInternal::Constructor1</code></a></li><li><a href="/docs/Design/Buffer Layer/IndBuffer#indinternal--indinternal-constructor-2"><code>IndInternal::Constructor2</code></a></li><li><a href="/docs/Design/Buffer Layer/IndBuffer#indleaf--indleaf-constructor-1"><code>IndLeaf::Constructor1</code></a></li><li><a href="/docs/Design/Buffer Layer/IndBuffer#indleaf--indleaf-constructor-2"><code>IndLeaf::Constructor2</code></a></li></ul><p>Implement the following functions looking at the respective design docs</p><ul><li><a href="/docs/Design/Buffer Layer/IndBuffer#indinternal--getentry"><code>IndInternal::getEntry()</code></a></li><li><a href="/docs/Design/Buffer Layer/IndBuffer#indleaf--getentry"><code>IndLeaf::getEntry()</code></a></li></ul><p>Add the following empty definitions to avoid compilation issues. We will implement these functions in later stages.</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> </span><span class="token class-name">IndInternal</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">setEntry</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">ptr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> indexNum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> </span><span class="token class-name">IndLeaf</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">setEntry</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">ptr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> indexNum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><p>An additional function we will need in the <a href="/docs/Design/Buffer Layer/intro">Buffer Layer</a> is the <code>StaticBuffer::getStaticBlockType()</code> function which takes a block number and returns the type of the block (<code>REC</code>/<code>IND_INTERNAL</code>/<code>IND_LEAF</code>/<code>UNUSED_BLK</code>/<code>BMAP</code>). We will use this function when we implement <code>bPlusSearch()</code> later in this stage.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Buffer/StaticBuffer.cpp</summary><div><div class="collapsibleContent_i85q"><p>Implement the <code>StaticBuffer::getStaticBlockType()</code> function by looking at the <a href="/docs/Design/Buffer Layer/StaticBuffer#staticbuffer--getstaticblocktype">design docs</a>.</p></div></div></details><p>Lastly, we implement the <a href="/docs/Design/B+ Tree Layer">B+ Tree Layer</a> function <code>bPlusSearch()</code> which comprises all the logic for an indexed search operation. Refer to the <a href="/docs/Misc/Indexing#search-on-b-tree">algorithm for search</a> if you have not done so already.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>BPlusTree/BPlusTree.cpp</summary><div><div class="collapsibleContent_i85q"><p>Implement the <code>BPlusTree::bPlusSearch()</code> by looking at the <a href="/docs/Design/B+ Tree Layer#bplustreebplussearch">design docs</a>.</p></div></div></details><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="exercises">Exercises<a href="#exercises" class="hash-link" aria-label="Direct link to Exercises" title="Direct link to Exercises">â€‹</a></h2><p><strong>Q1.</strong> Create a relation <code>Numbers(key NUM)</code> which will be used to store a list of numbers. Insert all the values from the file <a target="_blank" href="/assets/files/s10nums-ea5a74dc279190eb7ac169ac8f99cc96.csv">numbers.csv</a> into the relation. Run the following command <strong>in your NITCbase</strong> to select all numbers which are greater than 165,000 into a new relation.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT * FROM Numbers INTO BigNumbers WHERE key &gt; 165000;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create an index for this relation using the <a href="/docs/User Interface Commands/ddl#create-index">CREATE INDEX</a> command <strong>in the XFS Interface</strong>. Now, with an index on <code>Numbers.key</code>, re-run the above command and note the difference in time between the select queries with and without the index.</p><blockquote><p><strong>NOTE:</strong></p><ul><li>Don&#x27;t forget to exit NITCbase before running commands in the XFS Interface (refer to the <a href="/docs/Roadmap/Stage01#runtime-disk">WARNING</a> in the documentation of runtime disk).</li><li>The file <a target="_blank" href="/assets/files/s10nums-ea5a74dc279190eb7ac169ac8f99cc96.csv">numbers.csv</a> contains values for 166,464 records. As such, operations on the relation might take some time to complete.</li></ul></blockquote><p><strong>Q2.</strong> Modify your implementation to print the number of comparisons to do both of the above SELECT queries.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Roadmap/Stage09"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Stage 9 : Selection and Projection on Relations</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Roadmap/Stage11"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Stage 11: Index Creation and Deletion</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#implementation" class="table-of-contents__link toc-highlight">Implementation</a></li><li><a href="#exercises" class="table-of-contents__link toc-highlight">Exercises</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright"><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png"></a><br>Copyright Â© 2024 National Institute of Technology Calicut. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.72ea9b40.js"></script>
<script src="/assets/js/main.cbbded3f.js"></script>
</body>
</html>