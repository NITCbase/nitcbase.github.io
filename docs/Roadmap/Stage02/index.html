<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Roadmap/Stage02">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Stage 2: Disk Data Structures and Operations | NITCbase</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nitcbase.github.io/docs/Roadmap/Stage02"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Stage 2: Disk Data Structures and Operations | NITCbase"><meta data-rh="true" name="description" content="- Understand in detail about the different types of blocks on our XFS disk - record and index blocks"><meta data-rh="true" property="og:description" content="- Understand in detail about the different types of blocks on our XFS disk - record and index blocks"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://nitcbase.github.io/docs/Roadmap/Stage02"><link data-rh="true" rel="alternate" href="https://nitcbase.github.io/docs/Roadmap/Stage02" hreflang="en"><link data-rh="true" rel="alternate" href="https://nitcbase.github.io/docs/Roadmap/Stage02" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/feedback/rss.xml" title="NITCbase RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/feedback/atom.xml" title="NITCbase Atom Feed">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.6121986d.css">
<link rel="preload" href="/assets/js/runtime~main.dc332f49.js" as="script">
<link rel="preload" href="/assets/js/main.1f34ca7c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="NITCbase" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="NITCbase" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">NITCbase</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Roadmap/introduction">Roadmap</a><a class="navbar__item navbar__link" href="/docs/Design/Architecture">Design</a><a class="navbar__item navbar__link" href="/docs/User Interface Commands/introduction">NITCbase Commands</a><a class="navbar__item navbar__link" href="/docs/Misc/">Miscellaneous</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/feedback">Feedback</a><a class="navbar__item navbar__link" href="/AboutUs">About Us</a><a href="https://github.com/nitcbase" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.svg" alt="NITCbase" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="NITCbase" class="themedImage_ToTc themedImage--dark_i4oU"><b>NITCbase</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage00">Stage 0 : Installation and Preparation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage01">Stage 1 : Understanding the Disk Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/Roadmap/Stage02">Stage 2: Disk Data Structures and Operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Roadmap/Stage03">Stage 3 : The Frontend Interface</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Stage 2: Disk Data Structures and Operations (6 hours)</h1><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Learning Objectives</div><div class="admonitionContent_S0QG"><ul><li>Understand in detail about the different types of blocks on our XFS disk - record and index blocks</li><li>Learn in detail about the catalog data structures used in NITCbase - relation and attribute catalog</li><li>Learn the fundamentals of indexing</li><li>Learn about the runtime data structures used in NITCbase</li></ul></div></div><p><strong>WARNING!</strong> <em>make sure that you don&#x27;t get lost in the links as you follow along in this stage</em>. You&#x27;re not expected to read any links other than the ones mentioned specifically on this page. You&#x27;ll be able to understand all the layers in more detail as we go further.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="whats-on-the-disk">What&#x27;s on the disk?<a href="#whats-on-the-disk" class="hash-link" aria-label="Direct link to What&#x27;s on the disk?" title="Direct link to What&#x27;s on the disk?">​</a></h2><p>You must now be familiar with basic disk operations on the XFS disk. Here, we will discuss in detail the classification of blocks and other data structures that are used in NITCbase.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="records-and-catalogs">Records and Catalogs<a href="#records-and-catalogs" class="hash-link" aria-label="Direct link to Records and Catalogs" title="Direct link to Records and Catalogs">​</a></h3><p>The main purpose of a relational database is to store and retrieve records. When we initially start adding entries to a database, we can obtain a random free disk block and start dumping the values into it one after another and we can traverse it just as easily. But, we are soon going to run out of space on the disk block. What will we do then? We&#x27;ll get another random disk block and continue our process. But there&#x27;s now a complication. How will we traverse between these two disk blocks while reading these entries. Clearly, we&#x27;ll need to store the preceding and following disk block as some metadata in each block. You might&#x27;ve realized that this is in fact just a linked list and you&#x27;re right. Records in NITCbase are stored in a linked list of disk blocks.</p><p>Now, what exactly is a <strong>record</strong>? It is just an array of <strong>attribute values</strong>. Each relation can have a different number of attributes and the total number of records per disk block of a relation varies based on that. Each record block is divided into <strong>slots</strong> of variable record size and each slot stores a single record.</p><p>So, now we have a lot of relations each having their own records stored on the disk across multiple blocks. How do we identify and organise these blocks? The <strong>relation catalog</strong> solves this problem in NITCbase. It stores the relation name, the number of attributes and other information related to the record blocks for all the relations in the database.</p><p>We now have a provision to keep track of the list of relations that we have stored in the database. But we don&#x27;t have any information regarding the attributes of each relation. In a production database, an attribute can be one of a myriad of possible types, but here in NITCbase, we&#x27;ll restrict that to two possible <strong>types</strong>: <code>NUM</code> and <code>STR</code>. Numbers and strings, as the name would suggest. Both of these types are fixed at a size <strong>16 bytes</strong> for the sake of simplicity. The <strong>attribute catalog</strong> stores these details of all the attributes of every relation in the database. It also stores details about indices created on attributes. We&#x27;ll get into the details of indexing later.</p><p>The relation catalog and attribute catalog together allows us to get all the relations and their respective schemas from our disk. If you didn&#x27;t realise it yet, the relation and attribute catalog themselves are just relations on our disk! And as such, the blocks storing all the data we mentioned are just record blocks. The first entries in the relation catalog are for itself and the attribute catalog. And the first entries in the attribute catalog are the attributes of the relation catalog and the attributes of itself. Recall the <a href="/docs/Design/Physical Layer#disk-model">Disk Model</a> where you read that the first few blocks are reserved for these data structures.</p><p><strong>Read the documentation for <a href="/docs/Design/Physical Layer#record-block-structure">record blocks</a> and <a href="/docs/Design/Physical Layer#catalog-structures">catalog structures</a> before proceeding further.</strong></p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Q. Consider the following catalog entries and record for a relation.<table><thead><tr><th colspan="6">Relation Catalog Entry</th></tr></thead><tbody><tr><th>RelName</th> <th>#Attrs</th> <th>#Records</th> <th>FirstBlock</th> <th>LastBlock</th> <th>#Slots</th></tr><tr><td>Students</td> <td>?</td> <td>?</td> <td>34</td> <td>35</td> <td>?</td></tr></tbody></table><table><thead><tr><th colspan="6">Attribute Catalog Entry</th></tr></thead><tbody><tr><th>RelName</th> <th>AttrName</th> <th>AttrType</th> <th>PrimaryFlag</th> <th>RootBlock</th> <th>Offset</th></tr><tr><td>Students</td> <td>Name</td> <td>?</td> <td>-</td> <td>-1</td> <td>?</td></tr><tr><td>Students</td> <td>RollNo</td> <td>?</td> <td>-</td> <td>-1</td> <td>?</td></tr><tr><td>Students</td> <td>Marks</td> <td>?</td> <td>-</td> <td>-1</td> <td>?</td></tr></tbody></table><table><thead><tr><th colspan="6">section from the record block</th></tr></thead><tbody><tr><td>...</td> <td>B190539CS</td> <td>Jacques</td> <td>91.08</td> <td>...</td></tr></tbody></table><p>Assume that the relation has only two record blocks and both are fully filled. Find all the missing values (marked with <code>?</code>).<br>
(click to view answer)<br></p></summary><div><div class="collapsibleContent_i85q">pending answer. how to: 3 attrs -&gt; 41 slots -&gt; 82 records. attr type and offset from record.</div></div></details><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="indexes">Indexes<a href="#indexes" class="hash-link" aria-label="Direct link to Indexes" title="Direct link to Indexes">​</a></h3><p>We&#x27;d discussed the necessity of indexing in the earlier stage. NITCbase uses the B+ tree data structure for this purpose. <strong>Read the section about <a href="/docs/Misc/B+ Trees">B+ trees</a> before proceeding further.</strong></p><p>We now know about B+ trees and operations on them. How exactly does NITCbase use them?<br>
As we mentioned earlier, a relation in a production database can contain millions or records and might span over a large number of disk blocks. This relation will be made up of some number of attributes. If we find ourselves frequently doing operations on the values of one specific attribute, then it would be wise to create an index on that attribute for that relation.</p><p>For example, consider the relation <code>Student</code> having 5 attributes (<code>Roll No</code>, <code>Name</code>, <code>Marks</code>, <code>Grade</code>, <code>Attendance</code>). As an administrator, we might have to frequently get the subset of students having <code>Marks</code> greater than some amount <code>M</code>. Instead of going through each and every record and checking if it satisfies our condition, the index allows us to easily reach the first record with <code>Marks</code> &gt; <code>M</code>. We know that in a B+ tree, every subsequent leaf node will also satisfy this condition (Why?). You can see how this would save us a lot of time.</p><p>In NITCbase, indexes are B+ trees with <strong>internal nodes of size 100</strong>, and <strong>leaf nodes of size 63</strong>. Each of these nodes will be stored in a separate disk block. A fully filled internal node would consist of a 100 attribute values from various records and 101 pointers to their respective children. A pointer here refers to the block number of the corresponding internal or leaf index block. A fully filled leaf node would consist of 63 attribute values from various records along with the block number and slot number where the record containing this attribute can be found.</p><p>The <a href="/docs/Design/Physical Layer#attribute-catalog">attribute catalog</a> stores whether a particular attribute of a relation has an index. If it does, the <code>RootBlock</code> field of the attribute catalog will store the block number of the root block of the index.</p><p><strong>Read the documentation for <a href="/docs/Design/Physical Layer#internal-index-block-structure">internal index blocks</a> and <a href="/docs/Design/Physical Layer#leaf-index-block-structure">leaf index blocks</a> before proceeding further.</strong></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="whats-in-memory">What&#x27;s in memory?<a href="#whats-in-memory" class="hash-link" aria-label="Direct link to What&#x27;s in memory?" title="Direct link to What&#x27;s in memory?">​</a></h2><p>You now know all about the <a href="/docs/Design/Physical Layer">Physical Layer</a> of NITCbase and how the data is represented on the disk. However, disk operations are quite slow and a bottleneck to the efficient functioning of our database. Memory operations are much more efficient, but are subject to space constraints. We should ensure that our system makes optimum use of memory wherever possible to build a fast and responsive database.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="buffers">Buffers<a href="#buffers" class="hash-link" aria-label="Direct link to Buffers" title="Direct link to Buffers">​</a></h3><p>Following the <a href="https://en.wikipedia.org/wiki/Locality_of_reference" target="_blank" rel="noopener noreferrer">principle of locality</a>, NITCbase buffers all the disk i/o operations. We will be pre-allocating memory for holding 32 disk blocks in memory at a given time. Whenever a disk block is accessed for the first time, it will be loaded into the buffer. All subsequent operations on that block will be done on that buffer until that disk block is swapped out by a more recently required disk block. All the changes done to the buffer will be commited back to the disk at that point.</p><p>We&#x27;ll learn in detail about this as we implement the <a href="/docs/Design/Buffer Layer">Buffer Layer</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="caches">Caches<a href="#caches" class="hash-link" aria-label="Direct link to Caches" title="Direct link to Caches">​</a></h3><p>Almost all operations on a relation require access to its corresponding Relation Catalog and Attribute Catalog entries. We will be pre-allocating memory to cache the catalogs of 12 relations at a given time. A relation is said to be <strong>open</strong> if it&#x27;s catalog entries are loaded into memory. The <strong>relation catalog and attribute catalog are always open</strong> (recall that the relation and attribute catalog too are just relations in our database) since the values stored in these relations will be frequently used and it&#x27;s beneficial to avoid the overhead of loading it to memory as required. Any other relation will have to be <em>opened</em> before any operation can be done on it.</p><p>We have three data structures to store this information: <strong>the relation cache</strong>, the <strong>attribute cache</strong> and the <strong>open relation table</strong>. The open relation table stores details about the currently open relations. A relation needs to have an entry in the open relation table for it to be considered <em>open</em>. The relation cache stores the relation catalog entry of an open relation. The attribute cache stores details about all the attributes of an open relation as a linked list of attribute catalog entries. These caches also store a <code>searchIndex</code> field which saves the block and slot of the last search hit (we&#x27;ll cover this field later).</p><p>We&#x27;ll learn in detail about this as we implement the <a href="/docs/Design/Cache Layer">Cache Layer</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-comes-next">What comes next?<a href="#what-comes-next" class="hash-link" aria-label="Direct link to What comes next?" title="Direct link to What comes next?">​</a></h2><p>We now understand the low level representation of data in the disk blocks. How is this data saved as so? What do we do with this data? We&#x27;ll find out.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="allocating-new-blocks">Allocating New Blocks<a href="#allocating-new-blocks" class="hash-link" aria-label="Direct link to Allocating New Blocks" title="Direct link to Allocating New Blocks">​</a></h3><p>A new block can be obtained by looking at the <a href="/docs/Design/Physical Layer#disk-model">Block Allocation Map</a> for a free entry. We can then load this new block into the buffer and initialise the header with the required header values. If it&#x27;s a record block, we need to make sure that we add it to the linked list by setting <code>LBlock</code> and <code>RBlock</code>. An index block will have to be added as the appropriate left or right child and <code>PBlock</code> needs to be set.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="search-operations">Search Operations<a href="#search-operations" class="hash-link" aria-label="Direct link to Search Operations" title="Direct link to Search Operations">​</a></h3><p>A search operation involves fetching all records that satisfy some condition. In NITCbase, search can proceed in one of two ways. If an index is present on our search condition attribute, we can do a B+ search; else we&#x27;ll have to do a linear search on all the records of the relation. We&#x27;ll implement a function that will do the appropriate search and return to us a record that satisfies our condition each time it&#x27;s called. Higher levels can call this function until a null condition to fetch all the records satisfying the condition. You will implement this while working on the <a href="/docs/Design/Block Access Layer">Block Access Layer</a>.</p><p>You might&#x27;ve realized that the above function would require some global state to work as intended. We&#x27;ll need to keep track of the previously found record so that we can fetch the next record that satisfies the condition. And that is exactly what the <code>searchIndex</code> field in the relation and attribute cache do. <code>searchIndex</code> in the relation cache is used to store the last hit during linear search on that relation. <code>searchIndex</code> in the attribute cache is used to store the last hit during a B+ search on the index of that attribute. A value of <code>{-1, -1}</code> indicates that the search should start over from the beginning again.</p><p><strong>Read through the documentation for <a href="/docs/Misc/Indexing">indexing</a> to learn about the insertion and search operations on indexes.</strong> You will be implementing this while working on the <a href="/docs/Design/B+ Tree Layer">B+ Tree Layer</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="update-operations">Update Operations<a href="#update-operations" class="hash-link" aria-label="Direct link to Update Operations" title="Direct link to Update Operations">​</a></h3><p>All updates to the data are done on the buffer and commited to the disk as required. For a record/index block, the changes in the buffer will be written to the disk when the block is swapped out of the buffer to free up the slot. For operations which require modifications to the relation or attribute catalog, the changes will be written to their respective caches and written back to the disk when an NITCbase session terminates.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="freeing-blocks">Freeing Blocks<a href="#freeing-blocks" class="hash-link" aria-label="Direct link to Freeing Blocks" title="Direct link to Freeing Blocks">​</a></h3><p>To free a block, we update the block allocation map for that block index to be free and remove the reference to that block from any referencing blocks. Since NITCbase does not support a partial delete operation, we will not need to implement individual freeing of blocks and will only have to free all associated blocks at once.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><p>Q. Assume we have an empty database with no relations. We start it and create a table <code>LibraryBooks</code> with attributes (<code>name</code>: STR, <code>id</code>: NUM, <code>shelf</code>: NUM, <code>borrower</code>: STR).We then insert 1000 records into the relation <code>LibraryBooks</code> in descending order of their <code>id</code> (id from 1000 to 1).</p><ol><li>If we were to do a search for a book with <code>id</code> &lt; 500, which book would we get? What&#x27;s the corresponding <em>record-id=(block, slot)</em>?</li><li>We then create an index on <code>id</code> for <code>LibraryBooks</code>. How many index blocks would be created?</li><li>How many entries does the root block have? What is the rightmost value in the root block?</li><li>If we were to again do a search for a book with <code>id</code> &gt; 500, which book would we get? What&#x27;s the corresponding <em>record-id=(block, slot)</em>?</li><li>What are the contents of the relation cache and the attribute cache?</li><li>What are the contents of the relation catalog and attribute catalog on the disk?</li></ol><p>(click to view answer)</p></summary><div><div class="collapsibleContent_i85q"><p><strong>Answer</strong>(pending rewrite)</p><ol><li>book with <code>id</code> 1000 because that&#x27;s the first record</li><li>31 index blocks. 1 internal index.</li><li>30 entries. rightmost value is 969.</li><li>we would get the book with <code>id</code> 501 because it&#x27;s in ascending order</li><li>it would contain entries for the relation with the appropriate search index filled in.</li><li>it would be as if the relation was not created because we have not written back to the disk.</li></ol></div></div></details><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="exercises">Exercises<a href="#exercises" class="hash-link" aria-label="Direct link to Exercises" title="Direct link to Exercises">​</a></h2><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Q1. Insert question here</summary><div><div class="collapsibleContent_i85q">only final answers.</div></div></details></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Roadmap/Stage01"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Stage 1 : Understanding the Disk Interface</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Roadmap/Stage03"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Stage 3 : The Frontend Interface</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#whats-on-the-disk" class="table-of-contents__link toc-highlight">What&#39;s on the disk?</a><ul><li><a href="#records-and-catalogs" class="table-of-contents__link toc-highlight">Records and Catalogs</a></li><li><a href="#indexes" class="table-of-contents__link toc-highlight">Indexes</a></li></ul></li><li><a href="#whats-in-memory" class="table-of-contents__link toc-highlight">What&#39;s in memory?</a><ul><li><a href="#buffers" class="table-of-contents__link toc-highlight">Buffers</a></li><li><a href="#caches" class="table-of-contents__link toc-highlight">Caches</a></li></ul></li><li><a href="#what-comes-next" class="table-of-contents__link toc-highlight">What comes next?</a><ul><li><a href="#allocating-new-blocks" class="table-of-contents__link toc-highlight">Allocating New Blocks</a></li><li><a href="#search-operations" class="table-of-contents__link toc-highlight">Search Operations</a></li><li><a href="#update-operations" class="table-of-contents__link toc-highlight">Update Operations</a></li><li><a href="#freeing-blocks" class="table-of-contents__link toc-highlight">Freeing Blocks</a></li></ul></li><li><a href="#exercises" class="table-of-contents__link toc-highlight">Exercises</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/AboutUs">About Us</a></li><li class="footer__item"><a href="https://github.com/Nitcbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 National Institute of Technology Calicut. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.dc332f49.js"></script>
<script src="/assets/js/main.1f34ca7c.js"></script>
</body>
</html>